<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entity Generation Testing - TypeScript Services</title>
    <link rel="stylesheet" href="./test.css">
</head>
<body>
    <div class="container">
        <h1>Entity Generation Testing (TypeScript)</h1>
        
        <!-- API Key Input -->
        <div class="section">
            <h2>API Configuration</h2>
            <div class="input-group">
                <label for="apiKey">Google AI API Key:</label>
                <input type="password" id="apiKey" placeholder="Enter your Gemini API key">
                <button onclick="saveApiKey()">Save Key</button>
            </div>
            <p class="info">‚ö†Ô∏è For testing only - Key will be stored in local storage</p>
        </div>

        <!-- SHARED GAME CONTEXT (Used by all three entity types) -->
        <div class="section">
            <h2>üìã Game Context (Shared for All Entity Types)</h2>
            <p class="info">This context is used for Item, NPC, and Location generation. Expand sections you want to customize.</p>
            
            <!-- 1. Spatial Context -->
            <details open class="context-section">
                <summary>üìç Spatial Context</summary>
                <div class="form-grid">
                    <div class="form-section">
                        <h5>Current Location</h5>
                        <div class="input-field">
                            <label>ID</label>
                            <input type="text" id="spatial_location_id" value="loc_tavern_001">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Name</label>
                            <input type="text" id="spatial_location_name" value="The Rusty Anvil">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Description</label>
                            <textarea id="spatial_location_description" rows="2">A warm smoky tavern filled with travelers</textarea>
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Category</label>
                            <input type="text" id="spatial_location_category" value="building">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>X Coordinate</label>
                            <input type="number" id="spatial_location_x" value="5">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Y Coordinate</label>
                            <input type="number" id="spatial_location_y" value="5">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Region</label>
                            <input type="text" id="spatial_location_region" value="region_medieval_kingdom_001">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Rarity</label>
                            <select id="spatial_location_rarity">
                                <option value="common" selected>Common</option>
                                <option value="rare">Rare</option>
                                <option value="epic">Epic</option>
                                <option value="legendary">Legendary</option>
                            </select>
                            <span class="type-hint">Type: 'common' | 'rare' | 'epic' | 'legendary'</span>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h5>Current Region</h5>
                        <div class="input-field">
                            <label>ID</label>
                            <input type="text" id="spatial_region_id" value="region_medieval_kingdom_001">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Name</label>
                            <input type="text" id="spatial_region_name" value="Medieval Kingdom">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Theme</label>
                            <input type="text" id="spatial_region_theme" value="medieval">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Biome</label>
                            <input type="text" id="spatial_region_biome" value="temperate">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Description</label>
                            <textarea id="spatial_region_description" rows="2">A land of castles and knights</textarea>
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Region X</label>
                            <input type="number" id="spatial_region_x" value="0">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Region Y</label>
                            <input type="number" id="spatial_region_y" value="0">
                            <span class="type-hint">Type: number</span>
                        </div>
                    </div>
                </div>
            </details>

            <!-- 2. Entities Context -->
            <details class="context-section">
                <summary>üë• Entities Context</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>Nearby NPCs (JSON Array)</label>
                        <textarea id="entities_nearbyNPCs" rows="3">[]</textarea>
                        <span class="type-hint">Type: Array&lt;NearbyEntity & {relationshipStatus?: string}&gt;</span>
                    </div>
                    <div class="input-field">
                        <label>Nearby Items (JSON Array)</label>
                        <textarea id="entities_nearbyItems" rows="3">[]</textarea>
                        <span class="type-hint">Type: NearbyEntity[]</span>
                    </div>
                    <h5>Active NPC</h5>
                    <div class="input-field">
                        <label>ID</label>
                        <input type="text" id="entities_activeNPC_id" value="">
                        <span class="type-hint">Type: string</span>
                    </div>
                    <div class="input-field">
                        <label>Name</label>
                        <input type="text" id="entities_activeNPC_name" value="">
                        <span class="type-hint">Type: string</span>
                    </div>
                    <div class="input-field">
                        <label>Category</label>
                        <input type="text" id="entities_activeNPC_category" value="">
                        <span class="type-hint">Type: string</span>
                    </div>
                    <div class="input-field">
                        <label>Conversation Turns</label>
                        <input type="number" id="entities_activeNPC_turns" value="0">
                        <span class="type-hint">Type: number</span>
                    </div>
                </div>
            </details>

            <!-- 3. Player Context -->
            <details open class="context-section">
                <summary>üë§ Player Context</summary>
                <div class="form-grid">
                    <div class="form-section">
                        <h5>Stats</h5>
                        <div class="stats-grid">
                            <div class="input-field">
                                <label>Strength</label>
                                <input type="number" id="player_strength" value="15">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Dexterity</label>
                                <input type="number" id="player_dexterity" value="12">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Intelligence</label>
                                <input type="number" id="player_intelligence" value="18">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Wisdom</label>
                                <input type="number" id="player_wisdom" value="14">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Stealth</label>
                                <input type="number" id="player_stealth" value="10">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Charisma</label>
                                <input type="number" id="player_charisma" value="16">
                                <span class="type-hint">Type: number</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h5>Status</h5>
                        <div class="stats-grid">
                            <div class="input-field">
                                <label>Health</label>
                                <input type="number" id="player_health" value="85">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Max Health</label>
                                <input type="number" id="player_maxHealth" value="100">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Stamina</label>
                                <input type="number" id="player_stamina" value="60">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Max Stamina</label>
                                <input type="number" id="player_maxStamina" value="100">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Hunger</label>
                                <input type="number" id="player_hunger" value="40">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Max Hunger</label>
                                <input type="number" id="player_maxHunger" value="100">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Mana</label>
                                <input type="number" id="player_mana" value="90">
                                <span class="type-hint">Type: number</span>
                            </div>
                            <div class="input-field">
                                <label>Max Mana</label>
                                <input type="number" id="player_maxMana" value="100">
                                <span class="type-hint">Type: number</span>
                            </div>
                        </div>
                    </div>
                </div>
            </details>

            <!-- 4. Inventory Context -->
            <details class="context-section">
                <summary>üéí Inventory Context</summary>
                <div class="form-section">
                    <div class="stats-grid">
                        <div class="input-field">
                            <label>Total Items</label>
                            <input type="number" id="inventory_totalItems" value="8">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Empty Slots</label>
                            <input type="number" id="inventory_emptySlots" value="4">
                            <span class="type-hint">Type: number</span>
                        </div>
                    </div>
                    <h5>Rarity Distribution</h5>
                    <div class="stats-grid">
                        <div class="input-field">
                            <label>Common</label>
                            <input type="number" id="inventory_common" value="5">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Rare</label>
                            <input type="number" id="inventory_rare" value="2">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Epic</label>
                            <input type="number" id="inventory_epic" value="1">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Legendary</label>
                            <input type="number" id="inventory_legendary" value="0">
                            <span class="type-hint">Type: number</span>
                        </div>
                    </div>
                    <div class="input-field">
                        <label>Categories (comma-separated)</label>
                        <input type="text" id="inventory_categories" value="weapon, armor, consumable">
                        <span class="type-hint">Type: string[]</span>
                    </div>
                    <div class="input-field">
                        <label>Notable Items (comma-separated)</label>
                        <textarea id="inventory_notableItems" rows="2"></textarea>
                        <span class="type-hint">Type: string[]</span>
                    </div>
                </div>
            </details>

            <!-- 5. Equipment Context -->
            <details class="context-section">
                <summary>‚öîÔ∏è Equipment Context</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>Equipped Slots (comma-separated)</label>
                        <input type="text" id="equipment_equippedSlots" value="head, chest, leftHand">
                        <span class="type-hint">Type: string[]</span>
                    </div>
                    <div class="stats-grid">
                        <div class="input-field">
                            <label>Total Defense</label>
                            <input type="number" id="equipment_totalDefense" value="45">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Total Attack</label>
                            <input type="number" id="equipment_totalAttack" value="30">
                            <span class="type-hint">Type: number</span>
                        </div>
                    </div>
                    <div class="input-field">
                        <label>Notable Equipment (comma-separated)</label>
                        <textarea id="equipment_notableEquipment" rows="2"></textarea>
                        <span class="type-hint">Type: string[]</span>
                    </div>
                </div>
            </details>

            <!-- 6. World Context -->
            <details open class="context-section">
                <summary>üåç World Context</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>Time of Day</label>
                        <select id="world_timeOfDay">
                            <option value="dawn">Dawn</option>
                            <option value="morning">Morning</option>
                            <option value="afternoon">Afternoon</option>
                            <option value="dusk">Dusk</option>
                            <option value="night" selected>Night</option>
                            <option value="midnight">Midnight</option>
                        </select>
                        <span class="type-hint">Type: 'dawn' | 'morning' | 'afternoon' | 'dusk' | 'night' | 'midnight'</span>
                    </div>
                    <div class="input-field">
                        <label>Season</label>
                        <select id="world_season">
                            <option value="spring">Spring</option>
                            <option value="summer">Summer</option>
                            <option value="fall" selected>Fall</option>
                            <option value="winter">Winter</option>
                        </select>
                        <span class="type-hint">Type: 'spring' | 'summer' | 'fall' | 'winter'</span>
                    </div>
                    <div class="input-field">
                        <label>Weather</label>
                        <select id="world_weather">
                            <option value="clear">Clear</option>
                            <option value="rain" selected>Rain</option>
                            <option value="storm">Storm</option>
                            <option value="snow">Snow</option>
                            <option value="fog">Fog</option>
                        </select>
                        <span class="type-hint">Type: 'clear' | 'rain' | 'storm' | 'snow' | 'fog'</span>
                    </div>
                </div>
            </details>

            <!-- 7. Narrative Context -->
            <details class="context-section">
                <summary>üìñ Narrative Context</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>Active Quests (JSON Array)</label>
                        <textarea id="narrative_activeQuests" rows="3">[]</textarea>
                        <span class="type-hint">Type: QuestInfo[]</span>
                    </div>
                    <div class="input-field">
                        <label>Completed Quests (comma-separated)</label>
                        <textarea id="narrative_completedQuests" rows="2"></textarea>
                        <span class="type-hint">Type: string[]</span>
                    </div>
                    <div class="input-field">
                        <label>Recent Events (comma-separated)</label>
                        <textarea id="narrative_recentEvents" rows="2"></textarea>
                        <span class="type-hint">Type: string[]</span>
                    </div>
                    <div class="input-field">
                        <label>Player Actions (comma-separated)</label>
                        <textarea id="narrative_playerActions" rows="2">just_entered_location</textarea>
                        <span class="type-hint">Type: string[]</span>
                    </div>
                </div>
            </details>

            <!-- 8. Exploration Context -->
            <details class="context-section">
                <summary>üó∫Ô∏è Exploration Context</summary>
                <div class="form-section">
                    <div class="stats-grid">
                        <div class="input-field">
                            <label>Total Locations Explored</label>
                            <input type="number" id="exploration_totalLocationsExplored" value="5">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Unexplored Nearby</label>
                            <input type="number" id="exploration_unexploredNearby" value="2">
                            <span class="type-hint">Type: number</span>
                        </div>
                    </div>
                    <div class="input-field">
                        <label>Regions Visited (comma-separated)</label>
                        <input type="text" id="exploration_regionsVisited" value="Medieval Kingdom">
                        <span class="type-hint">Type: string[]</span>
                    </div>
                    <div class="input-field">
                        <label>Is First Visit</label>
                        <select id="exploration_isFirstVisit">
                            <option value="true">True</option>
                            <option value="false" selected>False</option>
                        </select>
                        <span class="type-hint">Type: boolean</span>
                    </div>
                </div>
            </details>

            <!-- 9. Relationships Context -->
            <details class="context-section">
                <summary>ü§ù Relationships Context</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>NPC Relationships (JSON)</label>
                        <textarea id="relationships_npcRelationships" rows="3">{}</textarea>
                        <span class="type-hint">Type: Record&lt;string, NPCRelationship&gt;</span>
                    </div>
                    <h5>Reputation</h5>
                    <div class="stats-grid">
                        <div class="input-field">
                            <label>Faction</label>
                            <input type="text" id="relationships_reputationFaction" value="">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Level (-100 to 100)</label>
                            <input type="number" id="relationships_reputationLevel" value="0" min="-100" max="100">
                            <span class="type-hint">Type: number</span>
                        </div>
                    </div>
                </div>
            </details>

            <!-- 10. Combat Context -->
            <details class="context-section">
                <summary>‚öîÔ∏è Combat Context</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>Danger Level</label>
                        <select id="combat_dangerLevel">
                            <option value="safe" selected>Safe</option>
                            <option value="low">Low</option>
                            <option value="moderate">Moderate</option>
                            <option value="high">High</option>
                            <option value="extreme">Extreme</option>
                        </select>
                        <span class="type-hint">Type: 'safe' | 'low' | 'moderate' | 'high' | 'extreme'</span>
                    </div>
                    <div class="input-field">
                        <label>Recent Combat</label>
                        <select id="combat_recentCombat">
                            <option value="true">True</option>
                            <option value="false" selected>False</option>
                        </select>
                        <span class="type-hint">Type: boolean</span>
                    </div>
                    <div class="input-field">
                        <label>Enemies Nearby</label>
                        <input type="number" id="combat_enemiesNearby" value="0">
                        <span class="type-hint">Type: number</span>
                    </div>
                    <div class="input-field">
                        <label>Player Combat Style</label>
                        <select id="combat_playerCombatStyle">
                            <option value="">None</option>
                            <option value="aggressive">Aggressive</option>
                            <option value="defensive">Defensive</option>
                            <option value="stealthy">Stealthy</option>
                            <option value="magical">Magical</option>
                        </select>
                        <span class="type-hint">Type: 'aggressive' | 'defensive' | 'stealthy' | 'magical'</span>
                    </div>
                </div>
            </details>

            <!-- 11. Economy Context -->
            <details class="context-section">
                <summary>üí∞ Economy Context</summary>
                <div class="form-section">
                    <div class="stats-grid">
                        <div class="input-field">
                            <label>Player Wealth</label>
                            <input type="number" id="economy_playerWealth" value="250">
                            <span class="type-hint">Type: number</span>
                        </div>
                        <div class="input-field">
                            <label>Local Prosperity</label>
                            <select id="economy_localProsperity">
                                <option value="poor">Poor</option>
                                <option value="modest" selected>Modest</option>
                                <option value="prosperous">Prosperous</option>
                                <option value="wealthy">Wealthy</option>
                            </select>
                            <span class="type-hint">Type: 'poor' | 'modest' | 'prosperous' | 'wealthy'</span>
                        </div>
                    </div>
                    <div class="input-field">
                        <label>Common Goods (comma-separated)</label>
                        <textarea id="economy_commonGoods" rows="2">bread, ale, iron</textarea>
                        <span class="type-hint">Type: string[]</span>
                    </div>
                    <div class="input-field">
                        <label>Rare Goods (comma-separated)</label>
                        <textarea id="economy_rareGoods" rows="2"></textarea>
                        <span class="type-hint">Type: string[]</span>
                    </div>
                </div>
            </details>

            <!-- 12. Meta Context -->
            <details open class="context-section">
                <summary>‚öôÔ∏è Meta Context</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>Generation Purpose</label>
                        <select id="meta_generationPurpose">
                            <option value="quest_reward">Quest Reward</option>
                            <option value="random_encounter" selected>Random Encounter</option>
                            <option value="shop_inventory">Shop Inventory</option>
                            <option value="dungeon_loot">Dungeon Loot</option>
                            <option value="world_building">World Building</option>
                        </select>
                        <span class="type-hint">Type: 'quest_reward' | 'random_encounter' | 'shop_inventory' | 'dungeon_loot' | 'world_building'</span>
                    </div>
                    <div class="input-field">
                        <label>Preferred Themes (comma-separated)</label>
                        <textarea id="meta_preferredThemes" rows="2"></textarea>
                        <span class="type-hint">Type: string[]</span>
                    </div>
                    <div class="input-field">
                        <label>Avoid Themes (comma-separated)</label>
                        <textarea id="meta_avoidThemes" rows="2"></textarea>
                        <span class="type-hint">Type: string[]</span>
                    </div>
                    <div class="input-field">
                        <label>Target Entity Category</label>
                        <input type="text" id="meta_targetEntityCategory" value="">
                        <span class="type-hint">Type: string</span>
                    </div>
                </div>
            </details>
        </div>

        <!-- GAME MEMORY STATE -->
        <div class="section">
            <h2>üß† Game Memory (Entity Storage & Spatial Index)</h2>
            <p class="info">This represents the GameMemory context state - the spatial index of all entities in the game world.</p>
            
            <!-- Entity Map -->
            <details open class="context-section">
                <summary>üó∫Ô∏è Entity Map (Coordinate Index)</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>Entity Map (JSON)</label>
                        <textarea id="memory_entityMap" rows="8">{"region_medieval_kingdom_001:0:0": {"locations": [{"id": "loc_castle_entrance_bui_001", "name": "Castle Entrance", "region": "region_medieval_kingdom_001"}], "npcs": [{"id": "npc_guard_gua_001", "name": "Castle Guard"}, {"id": "npc_merchant_mer_001", "name": "Merchant"}], "items": [{"id": "ite_key_key_001", "name": "Old Key"}, {"id": "ite_potion_con_001", "name": "Health Potion"}, {"id": "ite_scroll_con_001", "name": "Scroll"}]}, "region_medieval_kingdom_001:0:1": {"locations": [{"id": "loc_village_tow_001", "name": "Village Square"}], "npcs": [], "items": []}, "region_medieval_kingdom_001:1:0": {"locations": [{"id": "loc_forest_wil_001", "name": "Dark Forest"}], "npcs": [], "items": []}}</textarea>
                        <span class="type-hint">Type: Record&lt;string, CoordinateEntities&gt; where key is "region:x:y"</span>
                    </div>
                    <p class="info">Format: {"region:x:y": {"locations": [], "npcs": [], "items": []}}</p>
                </div>
            </details>

            <!-- All Items -->
            <details class="context-section">
                <summary>üì¶ All Items (Complete Item Registry)</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>All Items Array (JSON)</label>
                        <textarea id="memory_allItems" rows="8">[{"id": "ite_sword_wea_001", "name": "Sword", "rarity": "common", "image_url": "", "description": "A basic iron sword, standard issue for guards", "x": 0, "y": 0, "region": "inventory", "category": "weapon", "own_attributes": {"damage": {"value": 10, "type": "integer", "description": "Damage dealt in combat", "reference": "5=dagger, 10=sword, 20=greatsword"}, "equipSlot": {"value": "leftHand", "type": "string", "description": "Equipment slot for this item", "reference": "leftHand, rightHand, head, chest, legs, feet"}}}, {"id": "ite_shield_arm_001", "name": "Shield", "rarity": "common", "image_url": "", "description": "A wooden shield reinforced with iron bands", "x": 0, "y": 0, "region": "inventory", "category": "armor", "own_attributes": {"defense": {"value": 8, "type": "integer", "description": "Defense value against attacks", "reference": "5=light shield, 8=medium shield, 12=heavy shield"}, "equipSlot": {"value": "leftHand", "type": "string", "description": "Equipment slot for this item", "reference": "leftHand, rightHand, head, chest, legs, feet"}}}, {"id": "ite_key_key_001", "name": "Old Key", "rarity": "rare", "image_url": "", "description": "An old rusty key covered in moss", "x": 0, "y": 0, "region": "region_medieval_kingdom_001", "category": "key", "own_attributes": {"unlocks": {"value": "castle_gate", "type": "string", "description": "What this key unlocks", "reference": "castle_gate=main entrance, treasure_chest=valuables, dungeon_door=prison"}}}]</textarea>
                        <span class="type-hint">Type: Item[] (includes inventory + world items)</span>
                    </div>
                </div>
            </details>

            <!-- All Locations -->
            <details class="context-section">
                <summary>üè∞ All Locations (Complete Location Registry)</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>All Locations Array (JSON)</label>
                        <textarea id="memory_allLocations" rows="8">[{"id": "loc_castle_entrance_bui_001", "name": "Castle Entrance", "rarity": "rare", "image_url": "", "description": "The main gates of an ancient medieval castle. Massive wooden doors stand partially open, guarded by armored sentries.", "x": 0, "y": 0, "region": "region_medieval_kingdom_001", "category": "building", "own_attributes": {"emoji": {"value": "üè∞", "type": "string", "description": "Visual representation", "reference": "üè∞=castle, üèòÔ∏è=village, üå≤=forest"}}}, {"id": "loc_village_tow_001", "name": "Village Square", "rarity": "common", "image_url": "", "description": "A bustling village square with market stalls and friendly townsfolk.", "x": 0, "y": 1, "region": "region_medieval_kingdom_001", "category": "town", "own_attributes": {"emoji": {"value": "üèòÔ∏è", "type": "string", "description": "Visual representation", "reference": "üè∞=castle, üèòÔ∏è=village, üå≤=forest"}}}, {"id": "loc_forest_wil_001", "name": "Dark Forest", "rarity": "common", "image_url": "", "description": "Dense woods with towering ancient trees that block out most sunlight.", "x": 1, "y": 0, "region": "region_medieval_kingdom_001", "category": "wilderness", "own_attributes": {"emoji": {"value": "üå≤", "type": "string", "description": "Visual representation", "reference": "üè∞=castle, üèòÔ∏è=village, üå≤=forest"}}}]</textarea>
                        <span class="type-hint">Type: Location[] (all locations in the game world)</span>
                    </div>
                </div>
            </details>

            <!-- All NPCs -->
            <details class="context-section">
                <summary>üë• All NPCs (Complete NPC Registry)</summary>
                <div class="form-section">
                    <div class="input-field">
                        <label>All NPCs Array (JSON)</label>
                        <textarea id="memory_allNPCs" rows="8">[{"id": "npc_guard_gua_001", "name": "Castle Guard", "rarity": "common", "image_url": "", "description": "A stern-looking guard in chainmail armor, watching the castle entrance", "x": 0, "y": 0, "region": "region_medieval_kingdom_001", "chatHistory": [], "category": "guard", "own_attributes": {"hostile": {"value": false, "type": "boolean", "description": "Whether NPC is hostile to player", "reference": "true=enemy, false=friendly/neutral"}, "faction": {"value": "castle", "type": "string", "description": "NPC faction affiliation", "reference": "castle, merchants_guild, bandits, neutral"}, "greeting": {"value": "Halt! State your business at the castle.", "type": "string", "description": "Initial greeting message", "reference": "Standard greeting when player approaches"}}}, {"id": "npc_merchant_mer_001", "name": "Merchant", "rarity": "rare", "image_url": "", "description": "A jovial merchant with a colorful cart full of exotic goods", "x": 0, "y": 0, "region": "region_medieval_kingdom_001", "chatHistory": [], "category": "merchant", "own_attributes": {"hostile": {"value": false, "type": "boolean", "description": "Whether NPC is hostile to player", "reference": "true=enemy, false=friendly/neutral"}, "faction": {"value": "merchants_guild", "type": "string", "description": "NPC faction affiliation", "reference": "castle, merchants_guild, bandits, neutral"}, "greeting": {"value": "Welcome, traveler! Care to browse my wares?", "type": "string", "description": "Initial greeting message", "reference": "Standard greeting when player approaches"}, "inventory": {"value": ["ite_potion_con_002", "ite_map_too_002"], "type": "array", "description": "Items available for trade", "reference": "Array of item IDs this merchant sells"}}}]</textarea>
                        <span class="type-hint">Type: NPC[] (all NPCs in the game world)</span>
                    </div>
                </div>
            </details>

            <!-- Helper Information -->
            <details class="context-section">
                <summary>‚ÑπÔ∏è Memory Structure Info</summary>
                <div class="form-section">
                    <p class="info">
                        <strong>CoordinateEntities Interface:</strong><br>
                        { locations: Location[], npcs: NPC[], items: Item[] }
                    </p>
                    <p class="info">
                        <strong>Coordinate Key Format:</strong><br>
                        "region_id:x_coordinate:y_coordinate" (e.g., "region_medieval_kingdom_001:5:5")
                    </p>
                    <p class="info">
                        <strong>Complete Entity Registries:</strong><br>
                        - All Items: Every item in the game (inventory + world)<br>
                        - All Locations: Every location in the game world<br>
                        - All NPCs: Every NPC in the game world
                    </p>
                </div>
            </details>
        </div>

        <!-- ENTITY GENERATION (Each uses the shared GameContext above) -->
        <div class="section structured-section">
            <h2>Entity Generation (Uses Shared Context Above)</h2>
            <p class="info">All three entity types use the same GameContext defined above. Each has its own Game Rules.</p>
            
            <!-- Item Generation -->
            <div class="entity-subsection">
                <h3>üó°Ô∏è Item Generation</h3>
                
                <div class="input-group">
                    <label for="itemPrompt">Item Prompt:</label>
                    <input type="text" id="itemPrompt" placeholder="e.g., Create a legendary fire sword" value="Create a legendary fire sword">
                    <span class="type-hint">Type: string</span>
                </div>
                
                <h4>Game Rules</h4>
                <details open class="context-section">
                    <summary>üìú Item Game Rules</summary>
                    <div class="form-section">
                        <div class="input-field">
                            <label>Art Style</label>
                            <input type="text" id="item_rules_artStyle" value="historical illustration">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Genre</label>
                            <input type="text" id="item_rules_genre" value="exploration">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Historical Period</label>
                            <input type="text" id="item_rules_historicalPeriod" value="Medieval Europe 1200s">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Categories (JSON)</label>
                            <textarea id="item_rules_categories" rows="8">{"weapon": {"attributes": {"damage": {"type": "integer", "description": "Damage output", "reference": "20=common sword, 40=enchanted weapon, 60=rare weapon, 80=legendary weapon"}}}, "armor": {"attributes": {"defense": {"type": "integer", "description": "Defense value", "reference": "20=light armor, 50=medium armor, 70=heavy armor"}}}, "consumable": {"attributes": {"effect": {"type": "string", "description": "What it does", "reference": "heal, buff strength, restore mana, cure poison"}}}, "common": {"attributes": {"durability": {"type": "integer", "description": "Item durability", "reference": "50=average, 75=durable, 90=very durable, 100=indestructible"}}}}</textarea>
                            <span class="type-hint">Type: Record&lt;string, {attributes: Record&lt;string, AttributeMetadata&gt;}&gt;</span>
                    </div>
                    </div>
                </details>
                
                <button onclick="testItemGeneration()" class="btn-item">Generate Item</button>
                <div id="itemResult" class="entity-result-box" style="display: none;"></div>
            </div>

            <!-- NPC Generation -->
            <div class="entity-subsection">
                <h3>üë§ NPC Generation</h3>
                
                <div class="input-group">
                    <label for="npcPrompt">NPC Prompt:</label>
                    <input type="text" id="npcPrompt" placeholder="e.g., Create a legendary medieval blacksmith" value="Create a legendary medieval blacksmith">
                    <span class="type-hint">Type: string</span>
                </div>

                <h4>Game Rules</h4>
                <details open class="context-section">
                    <summary>üìú NPC Game Rules</summary>
                    <div class="form-section">
                        <div class="input-field">
                            <label>Art Style</label>
                            <input type="text" id="npc_rules_artStyle" value="historical portrait">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Genre</label>
                            <input type="text" id="npc_rules_genre" value="exploration">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Historical Period</label>
                            <input type="text" id="npc_rules_historicalPeriod" value="Medieval Europe 1200s">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Categories (JSON)</label>
                            <textarea id="npc_rules_categories" rows="8">{"merchant": {"attributes": {"trust": {"type": "integer", "description": "How much the NPC trusts the player", "reference": "0=hostile, 25=suspicious, 50=neutral, 75=friendly, 100=loyal ally"}}}, "guard": {"attributes": {"alertness": {"type": "integer", "description": "How alert and vigilant the guard is", "reference": "20=drowsy, 50=normal, 75=alert, 100=vigilant"}}}, "quest_giver": {"attributes": {"quest_difficulty": {"type": "integer", "description": "Difficulty of quests offered", "reference": "20=simple tasks, 50=moderate quests, 75=challenging quests, 100=legendary quests"}}}, "common": {"attributes": {"charisma": {"type": "integer", "description": "Social charm and influence", "reference": "20=awkward, 50=average, 75=charming, 100=legendary charisma"}}}}</textarea>
                            <span class="type-hint">Type: Record&lt;string, {attributes: Record&lt;string, AttributeMetadata&gt;}&gt;</span>
                        </div>
                    </div>
                </details>
                
                <button onclick="testNpcGeneration()" class="btn-npc">Generate NPC</button>
                <div id="npcResult" class="entity-result-box" style="display: none;"></div>
            </div>

            <!-- Location Generation -->
            <div class="entity-subsection">
                <h3>üè∞ Location Generation</h3>
                
                <div class="input-group">
                    <label for="locationPrompt">Location Prompt:</label>
                    <input type="text" id="locationPrompt" placeholder="e.g., Create an ancient haunted fortress" value="Create an ancient haunted fortress">
                    <span class="type-hint">Type: string</span>
                </div>

                <h4>Game Rules</h4>
                <details open class="context-section">
                    <summary>üìú Location Game Rules</summary>
                    <div class="form-section">
                        <div class="input-field">
                            <label>Art Style</label>
                            <input type="text" id="location_rules_artStyle" value="historical landscape">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Genre</label>
                            <input type="text" id="location_rules_genre" value="exploration">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Historical Period</label>
                            <input type="text" id="location_rules_historicalPeriod" value="Medieval Europe 1200s">
                            <span class="type-hint">Type: string</span>
                        </div>
                        <div class="input-field">
                            <label>Categories (JSON)</label>
                            <textarea id="location_rules_categories" rows="8">{"town": {"attributes": {"population": {"type": "integer", "description": "Number of inhabitants", "reference": "50=hamlet, 500=village, 5000=town, 50000=city"}}}, "dungeon": {"attributes": {"danger_level": {"type": "integer", "description": "How dangerous this location is", "reference": "20=minor threats, 50=moderate danger, 75=very dangerous, 100=deadly"}}}, "building": {"attributes": {"capacity": {"type": "integer", "description": "How many people it can hold", "reference": "10=small hut, 50=house, 100=inn, 500=castle hall"}}}, "wilderness": {"attributes": {"terrain": {"type": "string", "description": "Primary terrain type", "reference": "plains=open, forest=wooded, mountain=elevated"}}}, "common": {"attributes": {"accessibility": {"type": "integer", "description": "How easy it is to reach", "reference": "20=hidden/remote, 50=off the beaten path, 75=well-traveled, 100=major thoroughfare"}}}}</textarea>
                            <span class="type-hint">Type: Record&lt;string, {attributes: Record&lt;string, AttributeMetadata&gt;}&gt;</span>
                        </div>
                    </div>
                </details>
                
                <button onclick="testLocationGeneration()" class="btn-location">Generate Location</button>
                <div id="locationResult" class="entity-result-box" style="display: none;"></div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading hidden">
            <div class="spinner"></div>
            <p>Processing request...</p>
        </div>
    </div>

    <script type="module" src="./test.js"></script>
</body>
</html>
